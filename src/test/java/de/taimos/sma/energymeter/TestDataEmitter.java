package de.taimos.sma.energymeter;

import java.net.DatagramPacket;
import java.net.InetAddress;
import java.net.MulticastSocket;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

/**
 * Copyright 2014 Taimos GmbH<br>
 * <br>
 *
 * @author Thorsten Hoeger
 *
 */
public class TestDataEmitter {

	private static final String TESTDATA = "534D4100000402A000000001024400106069010E7142D0DD80F153A50001040000000000000108000000000026C7F300000204000000B93900020800000000005DA08DB000030400000031EC00030800000000001984D988000404000000000000040800000000000A208F28000904000000000000090800000000002B558428000A04000000BFD5000A0800000000006318EE68000D0400000003C60015040000000000001508000000000015484A5800160400000059CB00160800000000003A9D9DA80017040000000BF500170800000000000487B4B000180400000000000018080000000000002B85B8001D040000000000001D080000000000155632F8001E040000005A95001E0800000000003B06B1D0001F0400000026E70020040000038E3B00210400000003DF002904000000000000290800000000000ED8B860002A040000006A12002A080000000000519CADA0002B040000002752002B08000000000019AE2F90002C040000000000002C08000000000000BABEE00031040000000000003108000000000010E46C08003204000000712000320800000000005529CED0003304000000306F00340400000390FA00350400000003AA003D040000000AA4003D0800000000003CECA9F0003E040000000000003E0800000000000BABFAA8003F040000000000003F0800000000000158F880004004000000015B00400800000000000F444F300045040000000ABA004508000000000042FDBF00004604000000000000460800000000000BC878E00047040000000558004804000003886600490400000003E0900000000102045200000000";

	private static final Logger logger = LoggerFactory.getLogger(TestDataEmitter.class);


	public static void main(String[] args) {
		byte[] bytes = TestDataEmitter.hexStringToByteArray(TestDataEmitter.TESTDATA);
		String group = "239.12.255.254";
		int port = 9522;
		
		try (MulticastSocket socket = new MulticastSocket(port)) {
			while (true) {
				try {
					TestDataEmitter.logger.info("Sending next datagram to group {} and port {}", group, port);
					DatagramPacket dgram = new DatagramPacket(bytes, bytes.length, InetAddress.getByName(group), port);
					socket.send(dgram);

					Thread.sleep(1000);
				} catch (Exception e) {
					e.printStackTrace();
				}
			}
		} catch (Exception e) {
			e.printStackTrace();
		}
		
	}
	
	public static byte[] hexStringToByteArray(String s) {
		int len = s.length();
		byte[] data = new byte[len / 2];
		for (int i = 0; i < len; i += 2) {
			data[i / 2] = (byte) ((Character.digit(s.charAt(i), 16) << 4) + Character.digit(s.charAt(i + 1), 16));
		}
		return data;
	}
}
